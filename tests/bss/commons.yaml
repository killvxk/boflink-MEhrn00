# Test that COMMON symbols are correctly allocated in .bss section
# and that unreferenced COMMON symbols are removed
--- !COFF
header:
  Machine: IMAGE_FILE_MACHINE_AMD64
  Characteristics: [ IMAGE_FILE_RELOCS_STRIPPED ]
sections:
  - Name: '.text'
    Characteristics:
      - IMAGE_SCN_CNT_CODE
      - IMAGE_SCN_MEM_EXECUTE
      - IMAGE_SCN_MEM_READ
    Alignment: 16
    # Code that references both common symbols
    SectionData: '488B0500000000488B0D00000000C3'
    SizeOfRawData: 14
    Relocations:
      - VirtualAddress: 3
        SymbolName: common_symbol
        Type: IMAGE_REL_AMD64_REL32
      - VirtualAddress: 10
        SymbolName: other_common
        Type: IMAGE_REL_AMD64_REL32
symbols:
  - Name: go
    Value: 0
    SectionNumber: 1
    SimpleType: IMAGE_SYM_TYPE_NULL
    ComplexType: IMAGE_SYM_DTYPE_FUNCTION
    StorageClass: IMAGE_SYM_CLASS_EXTERNAL
  - Name: '.text'
    Value: 0
    SectionNumber: 1
    SimpleType: IMAGE_SYM_TYPE_NULL
    ComplexType: IMAGE_SYM_DTYPE_NULL
    StorageClass: IMAGE_SYM_CLASS_STATIC
    SectionDefinition:
      Length: 14
      NumberOfRelocations: 2
      NumberOfLinenumbers: 0
      CheckSum: 0
      Number: 0
      Selection: 0
  - Name: common_symbol
    Value: 0
    SectionNumber: 0
    SimpleType: IMAGE_SYM_TYPE_NULL
    ComplexType: IMAGE_SYM_DTYPE_NULL
    StorageClass: IMAGE_SYM_CLASS_EXTERNAL
  - Name: other_common
    Value: 0
    SectionNumber: 0
    SimpleType: IMAGE_SYM_TYPE_NULL
    ComplexType: IMAGE_SYM_DTYPE_NULL
    StorageClass: IMAGE_SYM_CLASS_EXTERNAL

--- !COFF
header:
  Machine: IMAGE_FILE_MACHINE_AMD64
  Characteristics: [ IMAGE_FILE_RELOCS_STRIPPED ]
sections: []
symbols:
  # This symbol should cause a .bss section to be created.
  # Since this symbol is smaller than the other common symbol, it should be placed after.
  - Name: common_symbol
    Value: 4
    SectionNumber: 0
    SimpleType: IMAGE_SYM_TYPE_NULL
    ComplexType: IMAGE_SYM_DTYPE_NULL
    StorageClass: IMAGE_SYM_CLASS_EXTERNAL

--- !COFF
header:
  Machine: IMAGE_FILE_MACHINE_AMD64
  Characteristics: [ IMAGE_FILE_RELOCS_STRIPPED ]
sections: []
symbols:
  # This symbol should cause a .bss section to be created.
  # Since this symbol is the largest, it should be placed at the beginning of the section.
  - Name: other_common
    Value: 8
    SectionNumber: 0
    SimpleType: IMAGE_SYM_TYPE_NULL
    ComplexType: IMAGE_SYM_DTYPE_NULL
    StorageClass: IMAGE_SYM_CLASS_EXTERNAL
